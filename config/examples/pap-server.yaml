# PAP (Policy Administration Point) Server Configuration

service:
  name: pap-server
  version: 1.0.0
  environment: production

server:
  host: 0.0.0.0
  port: 8090
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 300s
  graceful_stop: 60s

database:
  driver: postgres
  host: postgres
  port: 5432
  database: stratium_pap
  user: stratium
  password: stratium  # Override via STRATIUM_DATABASE_PASSWORD
  sslmode: disable
  max_open_conns: 50
  max_idle_conns: 10
  conn_max_lifetime: 30m
  conn_max_idle_time: 10m

cache:
  type: redis
  ttl: 10m
  redis:
    address: redis:6379
    db: 0
    prefix: "stratium:policy:"

oidc:
  enabled: false  # Disabled for Docker development (hostname issues)
  issuer_url: http://keycloak:8080/realms/stratium
  client_id: stratium-pap
  client_secret: stratium-pap-secret  # Override via STRATIUM_OIDC_CLIENT_SECRET
  redirect_url: http://localhost:8090/callback
  scopes:
    - openid
    - profile
    - email
    - groups

logging:
  level: info
  format: json
  output: stdout

security:
  rate_limiting:
    enabled: true
    requests_per_min: 200
    burst: 100
  cors:
    enabled: true
    allowed_origins:
      - http://localhost:3000
      - http://localhost:5173
    allowed_methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    allowed_headers:
      - Authorization
      - Content-Type
    expose_headers:
      - Content-Length
      - Content-Type
    allow_credentials: true
    max_age: 3600s

observability:
  metrics:
    enabled: true
    address: ":9091"
    path: /metrics